{"jobs":[{"name":"ojob debug","exec":"ow.loadFormat();print(\"\");cprint(ow.format.withSideLine(\"ARGS:\",__,\"YELLOW\",\"BOLD\",ow.format.withSideLineThemes().openBottomCurvedRect));cprint(ow.format.withSideLine(colorify(args),__,\"YELLOW\",__,ow.format.withSideLineThemes().openTopCurvedRect));cprint(ow.format.withSideLine(\"RES:\",__,\"YELLOW,BOLD\",\"BOLD\",ow.format.withSideLineThemes().openBottomCurvedRect));cprint(ow.format.withSideLine(colorify($get(\"res\")),__,\"YELLOW,BOLD\",__,ow.format.withSideLineThemes().openTopCurvedRect))"},{"name":"ojob get","help":"Retrieves a specific map key (or path) using $get\n\n  key  (String)  Map key or path\n","exec":"args.key=_$(args.key,\"key\").isString().default(\"res\");var a=$get(args.key);isArray(a)&&(a={_list:a});return a"},{"name":"ojob file get","help":"Retrieves a specific map key (or path) from an YAML or JSON file provided.\n\n  __file  (String)  The file path to an YAML or JSON file\n  __key   (String)  Map key or path on the file contents\n  __cache (Boolean) If false it won't cache the file contents (default: true)\n  __ttl   (Number)  If cache is enabled lets you definea ttl\n  __out   (String)  The path on args to set the map key/path contents\n","exec":"args.__file=_$(args.__file,\"__file\").isString().$_();args.__key=_$(args.__key,\"__key\").isString().default(\"res\");args.__cache=toBoolean(_$(args.__cache,\"__cache\").default(\"true\"));args.__ttl=_$(args.__ttl,\"__ttl\").isNumber().default(__);args.__out=_$(args.__out,\"__out\").isString().default(__);if(args.__cache){var c=$cache(\"__ojob_file_get\");isDef(args.__ttl)&&(c=c.ttl(args.__ttl));c=c.fn(function(a){return isDef(a.file)?a.file.endsWith(\".json\")?io.readFileJSON(a.file):/\\.ya?ml$/.test(a.file)?\nio.readFileYAML(a.file):{error:\"Not an yaml, yml or json file.\"}:{}}).create();var b=c.get({file:args.__file})}else b=args.__file.endsWith(\".json\")?io.readFileJSON(args.__file):/\\.ya?ml$/.test(args.__file)?io.readFileYAML(args.__file):{error:\"Not an yaml, yml or json file.\"};b=$$(b).get(args.__key);isDef(args.__out)?$$(args).set(args.__out,b):Object.keys(b).forEach(function(a){return $$(args).set(a,b[a])})"},{"name":"ojob function","help":"Executes the provided function mapping any args to the function arguments using the odoc help available for the provided function. Note: accessing odoc might be slow on a first execution.\n\n  __key     (String)  The key string to retrieve previous results (defaults to 'res')\n  __fn      (String)  The function to execute\n  __path    (String)  If defined the args path for the function arguments to consider\n  __fnPath  (String)  If defined the args path where to set the function result\n","exec":"_$(args.__fn,\"__fn\").isString().$_();0>args.__fn.indexOf(\".\")&&(args.__fn=\"global.\"+args.__fn);var a=$fnM(args.__fn,isDef(args.__path)?$$(args).get(args.__path):args);isString(args.__fnPath)&&(a=$$({}).set(args.__fnPath,a));if(isString(args.__key))$set(args.__key,a);else return a"},{"name":"ojob output","help":"Prints the current arguments to the console. Optionally expects:\n\n   key      (String)  The key string to retrieve previous results (defaults to 'res')\n   path     (String)  A path string to a map/array over the results set on key. \n   format   (String)  The output format (e.g. see ow.oJob.output help)\n   title    (String)  Encapsulates the output map/array with a title key.\n   internal (Boolean) If true it will display the internal oJob entries on the arguments (default false)\n","exec":"args.key=_$(args.key,\"key\").isString().default(\"res\");var a=$get(args.key);isUnDef(a)&&(a=args);isDef(a)&&!toBoolean(args.internal)&&(delete a.objId,delete a.execid,delete a.id);isDef(args.format)&&(args.__format=args.format,delete args.format);isDef(args.path)&&(a=$$(a).get(args.path));isMap(a)&&isDef(a._list)&&(a=a._list);isMap(a)&&isDef(a._map)&&(a=a._map);if(isDef(args.title)){var b={};b[args.title]=a;ow.oJob.output(b,args)}else ow.oJob.output(a,args)"},{"name":"ojob final report","to":"ojob report","type":"shutdown","help":"Outputs a jobs report (e.g. job name, status, number of executions, total time, avg time and last execution) upon ojob termination\n\n  __format  (String)  Can be json, yaml, table (default) or any other ow.oJob.output format\n"},{"name":"ojob report","help":"Outputs a jobs report (e.g. job name, status, number of executions, total time, avg time and last execution)\n\n  __format  (String)  Can be json, yaml, table (default) or any other ow.oJob.output format\n","exec":"ow.loadFormat();print(\"\\n\");var b=$ch(\"oJob::log\").getAll(),c=$from(b).notEquals(\"name\",\"ojob report\").notEquals(\"name\",\"ojob final report\").select(function(a){return{\"Job name\":a.name,Status:a.start?a.success?\"OK\":a.deps?a.error?\"NOT OK!\":\"executing\":\"failed deps\":\"not started\",\"# execs\":a.count,\"Total time\":ow.format.elapsedTime4ms(a.totalTime,{abrev:!0}),\"Avg time\":ow.format.elapsedTime4ms(a.avgTime,{abrev:!0}),\"Last exec\":0<a.log.length?ow.format.timeago($from(a.log).sort(\"-endTime\").at(0).endTime):\n\"n/a\"}});c.push({\"Job name\":\"TOTAL:\",Status:\"\",\"# execs\":\"\",\"Total time\":ow.format.elapsedTime4ms(now()-$from(b).sort(\"createDate\").at(0).createDate),\"Avg time\":\"\",\"Last exec\":\"\"});args.__format=_$(args.__format).default(\"table\");ow.oJob.output(c,args)"},{"name":"ojob options","help":"Adds new \"todo\" entries depending on the value of a provided args variable. Expects:\n\n  optionOn      (String)  The variable in args that will define which set of \"todo\"s will be added (trimmed)\n  lowerCase     (Boolean) Compare the switchOn in lower case (defaults to false)\n  todos.[value] (Map)     Map of \"todo\"s\n  default       (Array)   Default map of \"todo\"s\n\n  Example:\n\n    optionOn : mode\n    lowerCase: true\n    todos    :\n      mode1:\n      - Job 1\n      - Job 2\n      mode2:\n      - Job 2\n      - Job 3\n    default:\n    - Job 2\n","exec":"_$(args.optionOn,\"optionOn\").isString().$_();_$(args.todos,\"todos\").isMap().$_();args.lowerCase=_$(args.lowerCase,\"lowerCase\").isBoolean().default(!1);args.default=_$(args.default,\"default\").isArray().default([]);args.end=_$(args.end,\"end\").isArray().default([]);var b=String(args[args.optionOn]).trim();args.lowerCase&&(b=b.toLowerCase());var c=args,d=function(a){return isMap(a)?$job(a.name,merge(a.args,c)):$job(a,c)};isDef(args.todos[b])&&isArray(args.todos[b])?args.todos[b].forEach(function(a){return c=\nd(a)}):args.default.map(function(a){return c=d(a)})"},{"name":"ojob sec get","help":"This job will get a SBucket secret and map it to oJob's args:\n\n  - secIn               (String)  The args path where all the remaining sec arguments should be read from (defaults to no path)\n  - [secIn].secOut      (string)  The args path to be mapped with the secret (defaults to secIn)\n  - [secIn].secKey      (string)  The SBucket key\n  - [secIn].secRepo     (string)  The SBucket repository\n  - [secIn].secBucket   (string)  The SBucket name\n  - [secIn].secPass     (string)  The SBucket password\n  - [secIn].secMainPass (string)  The SBucket repository password\n  - [secIn].secFile     (string)  Optional provide a specific sbucket file\n  - [secIn].secDontAsk  (string)  Determine if passwords should be asked from the user (default=false)\n  - [secIn].secIgnore   (boolean) If true will ignore errors of sec parameters not being provided (default=false)\n","exec":"var a=_$(args.secIn,\"secIn\").isString().default(\"\");\"\"!=a&&(a+=\".\");var e=_$($$(args).get(a+\"secIgnore\"),\"secIgnore\").isBoolean().default(!1),f=_$($$(args).get(a+\"secOut\"),\"secOut\").default(\"\"!=a?a.replace(/\\.$/,\"\"):__);e||_$($$(args).get(a+\"secKey\"),\"secKey\").$_();e=toBoolean(_$($$(args).get(a+\"secDontAsk\"),\"secDontAsk\").default(!1));var d=_$($$(args).get(a+\"secKey\"),\"secKey\").default(__),b=_$($$(args).get(a+\"secBucket\"),\"secBucket\").default(__),g=_$($$(args).get(a+\"secPass\"),\"secPass\").default(__),\nk=_$($$(args).get(a+\"secFile\"),\"secFile\").default(__),h=_$($$(args).get(a+\"secRepo\"),\"secRepo\").default(__);a=_$($$(args).get(a+\"secMainPass\"),\"secMainPass\").default(__);!e&&isDef(d)&&(b=askDef(b,\"Sec bucket: \"),isDef(b)&&isUnDef(k)&&(g=askDef(g,\"Sec bucket '\"+b+\"' pass: \",!0)),isDef(h)&&(a=askDef(a,\"Sec repo '\"+h+\"' pass: \",!0)));if(isDef(d)){var c=$sec(h,b,g,a,k).get(d);if(isUnDef(c))throw\"Couldn't retrieve secKey '\"+d+\"' from bucket '\"+b+\"'!\";isDef(f)?(a=$$(args).get(f),$$(args).set(f,isDef(a)?\nmerge(a,c):c)):Object.keys(c).forEach(function(l){return $$(args).set(l,c[l])})}"},{"name":"ojob split to items","help":"Splits an args source into an array of maps (_list). Expects:\n\n  source    (String)  A object path to the string source to split\n  separator (String)  The separator for the source string (defaults to \\n)\n\nExample:\n\n  a source string with the value \"abc, xyz, 1\"\n  + separator = ','\n  transforms into:\n\n  - item: abc\n  - item: xyz\n  - item: 1\n","exec":"_$(args.source,\"source\").isString().$_();args.separator=_$(args.separator,\"separator\").isString().default(\"\\n\");ow.loadObj();args._list=String(ow.obj.getPath(args,args.source)).split(args.separator).map(function(a){return{item:a}})"},{"name":"ojob query","exec":"args.where=_$(args.where,\"where\").isArray().default([]);args.select=_$(args.select,\"select\").default(__);args.transform=_$(args.transform,\"transform\").isArray().default([]);args.selector=_$(args.selector,\"selector\").isMap().default(__);args.fromKey=_$(args.fromKey,\"fromKey\").isString().default(\"res\");var a=isDef(args.from)?$from($$($get(args.fromKey)).get(args.from)):$from($get(args.fromKey));args.where.forEach(function(c){return isString(c.cond)?a=a[c.cond].apply(a,c.args):c});args.transform.forEach(function(c){return isString(c.func)?\na=a[c.func].apply(a,c.args):c});var b;isString(args.select)&&(b=a.select(new Function(\"elem\",\"index\",\"array\",args.select)));isMap(args.select)&&(b=a.select(args.select));isUnDef(b)&&isMap(args.selector)&&(b=isString(args.selector.func)?$$({}).set(args.selector.func,a[args.selector.func].apply(a,args.selector.args)):b);isUnDef(b)&&isUnDef(args.select)&&(b=a.select());if(isString(args.key))$set(args.key,b);else return isArray(b)?{_list:b}:b"},{"name":"ojob set envs","help":"Sets job args based on environment variables. Expects:\n\n  envs  (Map) A map where each key corresponds to an environment variable and the value to the args path where it should be placed\n","exec":"_$(args.envs,\"envs\").isMap().$_();Object.keys(args.envs).forEach(function(a){var b=args.envs[a];a=getEnv(a);isDef(a)&&!isNull(a)&&$$(args).set(String(b),String(a))})"},{"name":"ojob set state","help":"Changes the current state. Expects:\n\n  state  (String) The state to change to (to execute todo.when)\n","exec":"_$(args.state,\"state\").isString().$_();ow.oJob.setState(args.state)"},{"name":"ojob get state","help":"Gets the current state into args.state.\n","exec":"args.state=ow.oJob.getState()"},{"name":"ojob state","help":"Changes the current state depending on the value of a provided args variable. Expects:\n\n  stateOn     (String)  The variable in args that will define the current global set (to execute todo.when)\n  lowerCase   (Boolean) Compare the stateOn in lower case (defaults to false)\n  validStates (Array)   An array of valid states to change to. If not included the default will be choosen (or none).\n  default     (Array)   Default map of \"todo\"s\n\n  Example:\n\n    stateOn  : mode\n    lowerCase: true\n    default  : Help\n","exec":"args.stateOn=_$(args.stateOn,\"stateOn\").default(\"state\");args.lowerCase=_$(args.lowerCase,\"lowerCase\").isBoolean().default(!1);args.state=_$(args[args.stateOn],args.stateOn).default(args.default);args.lowerCase&&isString(args.state)&&(args.state=args.state.toLowerCase());isArray(args.validStates)&&0>args.validStates.indexOf(args.state)&&(isDef(args.default)?args.state=args.default:args.state=__);isString(args.state)&&isDef(ow.oJob.setState)&&ow.oJob.setState(args.state)"}]}